% *****************************************************************************
%
%        FASThesis Manual
%        (FASThesis Class File Documentation)
%
%        Faculty of Applied Sciences
%        University of West Bohemia
%
%        Manual & Explanatory Document
%        Copyright (c) 2022-2024 Kamil Ekštein, Dept. of Computer Science
%        and Engineering, Faculty of Applied Sciences, UWB
%
%        Version:  0.93
%		 Encoding: UTF-8
%		 TeXer:    pdflatex
%
%        Last modification on 14-Feb-2024 by KE
%
% *****************************************************************************

% _____________________________________________________________________________
%
%
%	     DOCUMENT HEADER
%
% _____________________________________________________________________________
\documentclass[english, sem, kiv, he, iso690alph, pdf, viewonly]{fasthesis}
\usepackage{acronym}
\usepackage{listings}
\usepackage{color}
\usepackage{float}
\usepackage{dirtree}

\lstset{
    language=bash,
    basicstyle=\ttfamily\footnotesize,
    keywordstyle=\color{blue}\bfseries,
    commentstyle=\color{gray},
    stringstyle=\color{red},
    frame=single,
    showstringspaces=false,
    breaklines=true
}

\title{Fundamentals of Computer Networks. Multiplayer game "Reversi"}
%\worktypespec{Technická zpráva}% <== this command is only applicable if 'oth' switch is used above
\author{Volodymyr}{Pavlov}{}{}
\supervisor{Ing. Martin Úbl}
% \stagworkid{}% <== the unique identifier of the work in the STAG information system
% \auxfrontmattercontent{% <== this command only makes sense if 'oth' switch is used above
	% \section*{Test}%
	% Tento text bude vložen do front matteru\dots
% }
% _____________________________________________________________________________
%
%
%	     DOCUMENT FRONTMATTER TEXTS
%
% _____________________________________________________________________________
%
% *** English abstract ***

% _____________________________________________________________________________
%
%        ACKNOWLEDGEMENT
% _____________________________________________________________________________
%
% _____________________________________________________________________________
%
%
%	     DOCUMENT TEXT BEGINNING
%
% _____________________________________________________________________________

\begin{document}
\frontpages[notm] % or notm if the `trademark' declaration is not needed
\tableofcontents
% 
% -x---- ADDITIONAL COLOUR DEFINITIONS ----------------------------------------
%
\makeatletter%
\ifx\FASThesis@style\c@fullcolor%
	\definecolor{fascolor}{cmyk}{0.06, 0.27, 1.0, 0.12}%
	\definecolor{fascolordk}{cmyk}{0.05, 0.28, 1.0, 0.24}%
\else%
	\definecolor{fascolor}{cmyk}{0, 0, 0, 0.6}%
	\definecolor{fascolordk}{cmyk}{0, 0, 0, 0.75}%
\fi%
\makeatother%
\lstdefinestyle{plainsrc}{
	backgroundcolor=\color{fascolor!10},
	basicstyle=\ttzfamily\footnotesize,
	numberstyle=\tiny\color{fascolordk},
	numbers=left,
	numbersep=5pt,
	keepspaces=true,
	tabsize=2,
	extendedchars=true,
	literate={á}{{\'a}}1 {č}{{\v{c}}}1 {ď}{{\v{d}}}1 {é}{{\'e}}1 {ě}{{\v{e}}}1 {è}{{\`{e}}}1 {í}{{\'{\i}}}1 {ľ}{{\v{l}}}1 {ň}{{\v{n}}}1 {ó}{{\'o}}1 {ŕ}{{\'r}}1 {ř}{{\v{r}}}1 {š}{{\v{s}}}1 {ť}{{\v{t}}}1 {ú}{{\'u}}1 {ů}{{\r{u}}}1 {ý}{{\'y}}1 {ž}{{\v{z}}}1
	{Á}{{\'A}}1 {Č}{{\v{C}}}1 {Ď}{{\v{D}}}1 {É}{{\'E}}1 {Ě}{{\v{E}}}1 {È}{{\`{E}}}1 {Í}{{\'I}}1 {Ľ}{{\v{L}}}1 {Ň}{{\v{N}}}1 {Ó}{{\'O}}1 {Ŕ}{{\'R}}1 {Ř}{{\v{R}}}1 {Š}{{\v{S}}}1 {Ť}{{\v{T}}}1 {Ú}{{\'U}}1 {Ů}{{\r{U}}}1 {Ý}{{\'Y}}1 {Ž}{{\v{Z}}}1
}
% -x---- END OF ADDITIONAL COLOUR DEFINITIONS ---------------------------------
% _____________________________________________________________________________
%
%
%        CHAPTER
%
% _____________________________________________________________________________

\chapter{Task}

Create a multiplayer game 'Reversi'. Solution should contain a server (written in C) with TCP scoket, which can process many players and at the same time can save game state. Client application (written in Kotlin), should support client login. After a login, client should continue with a last known state. \\

Implemented solution should be stable and be able to handle unexpected behavior (wrong input, client/server lost connection).

\chapter{Game rules}

Player color (white and black) is distributed randomly between two players. White player begins. Each turn, the player places one piece on the board with their color facing up.

Game starts with placing 4 pieces (2 of each color) in the middle of the board, so called \textit{initial board state}, which can be seen in the Figure \ref{fig:Initial_game_state}.

Each piece played must be laid adjacent to an opponent's piece so that the opponent's piece or a row of opponent's pieces is flanked by the new piece and another piece of the player's color. All of the opponent's pieces between these two pieces are 'captured' and turned over to match the player's color.

It can happen that a piece is played so that pieces or rows of pieces in more than one direction are trapped between the new piece played and other pieces of the same color. In this case, all the pieces in all viable directions are turned over.

The game is over when neither player has a legal move (i.e. a move that captures at least one opposing piece) or when the board is full.

\begin{figure}[h!]
	\centering
	\begin{minipage}[b]{0.4\textwidth}
		\centering
		\includegraphics[width=\textwidth]{resources/game-initial-state.png}
    \end{minipage}
	\caption{Possible game initial state.}
	\label{fig:Initial_game_state}
\end{figure}

\chapter{Task Analysis}

Due to a task restriction of using any existing data-interchange format (like \textit{\ac{JSON}} or \textit{\ac{XML}}), a proprietary one should be created to be used in communication between server and client. Flexible data-interchange format should improve extensibility of requests and responses.
The most challenging part will be to ensure multi-thread clients handing on server side, and proper error/unexpected behavior handing on both sides.

\section{Key Components for Implementation}

\begin{enumerate}
	\item \textbf{Game engine} - this component will be response for all game-related processes.
		\begin{itemize}
			\item \textbf{Game board}  - create a data structure to store current game state.
			\item \textbf{Move validation} - check if player move is correct and can be processed.
			\item \textbf{Move processing} - process a correct move within all possible directions.
		\end{itemize}

	\item \textbf{Communication protocol}
		\begin{itemize}
			\item \textbf{\ac{REST}} - \ac{REST}-like connection protocol will be used for communication between client\footnote{From now the \textit{client} will be used in the meaning of a client application, connected to the server.} and server. It means, that whole communication will work in the way one client request will have one server response. Server will not send any non-client requested data.
			\item \textbf{Message header} - Each message should have a header of a predefined length. The header should contain an identifier (to be sure that the socket is used by correct client), and a payload length (can be zero in case of empty payload).
			\item \textbf{Message payload} - The payload is not mandatory. Payload should have a predefined structure to ensure correct composition, parsing and to make it easily extendable with additional values.
			\item \textbf{HTTP-like codes} - Each header should contain HTTP-like status code for easy flow and error handling.
			\item \textbf{Operation codes} - Each header should contain so-called \textit{operation code} to differentiate message types handling.
		\end{itemize}
	\item \textbf{Server components}
		\begin{itemize}
			\item \textbf{Clients handling} - each client will have its own thread on server side, which will process every client request.
			\item \textbf{Operations synchronization} - every data-related action should be synchronized to avoid concurrent resource access.
			\item \textbf{Client timeouts} - if a client has not performed a request for the last \textbf{N} minutes (N is configurable), then the client should be disconnected and related socket should be closed.
			\item \textbf{Invalid client operations} - server should correctly react on any client's invalid operation (malformed request, action which is not possible in the current client state).
			\item \textbf{Client flow state} - each client can be in a one of the flow state: [\textit{LOGIN, MENU, LOBBY, GAME}] \footnote{Described more detailed in the [section ref]}. The client flow state should be synchronized between server and client, and the server value will be the only source of truth \footnote{It means, that a client-side flow state for some reason does not match server-side value, then it should be adjusted on the client side.}.
		\end{itemize}
	\item \textbf{Client components} - Entire client application will be implemented using \ac{KMP} for backend and frontend.
		\begin{itemize}
			\item \textbf{\ac{UI}} - Easy and user-friendly \ac{UI} will be implemented using \ac{CMP}.
			\item \textbf{State synchronization} - Client state should be server-driven and synchronized to avoid inconsistent client state.
			\item \textbf{Continue on client login} - After login, client should synchronize state with server and continue from a state, where client was.
		\end{itemize}
\end{enumerate}

\chapter{Custom data-interchange format}
\label{chap:custom_data_format}

For a data-interchange format for payload a string with semicolon delimiters was chosen. Supported data types can be found in the Table \ref{tab:payload_data_types}. A payload then can be composed into a string, which then can be transmitted via TCP socket. Also, the payload can be easily parsed from a string into objects format using regex expressions.

\begin{table}[h]
	\centering
	\begin{tabular}{|l|l|l|}
		\hline
		\textbf{Data Type} & \textbf{Syntax} & \textbf{Example} 	\\ \hline
		Integer & key=\{int\_value\} & key=123 \\ \hline
		String 	& key="\{string\_value\}" & key="123" \\ \hline
		Boolean	& key=\{bool\_value\} & key=true \\ \hline
		Integer Array	& key= [\{int\_value0\},\{int\_value1\}] & key=[1,2,3,4] \\ \hline
		String Array	& key= ["\{string\_value0\}","\{string\_value1\}"] & key=[“str1”, “str2”] \\ \hline
		No Value	& key=null & key=null \\ \hline
	\end{tabular}
	\caption{Payload supported data types.}
	\label{tab:payload_data_types}
\end{table}

\chapter{Communication Protocol}

Communication protocol is inspired by \ac{REST} style and \ac{HTTP}. Any information transmitting is driven by a client (client sends a request to a server and waits for a response).

Each message (request or response) contains a header, which has predefined constant length, and a payload, which contains useful information (may be empty for some cases).

\section{Header}

Message \textit{header} has length of 17 bytes and contains 5 sections described in Table \ref{tab:header_sections}. Header has always constant structure: \texttt{[Identificator,Length,Type,Subtype,
Status]}.

\begin{table}[h]
	\centering
	\begin{tabular}{|l|l|l|p{140pt}|}
		\hline
		\textbf{Section} & \textbf{Length (bytes)} & \textbf{Data Type} & \textbf{Description}	\\ \hline
		\textbf{Identificator} & 4 & String & Unique identificator for client-server connection \\ \hline
		\textbf{Length} & 7 & Integer & Length of the message payload (max is 9999999) \\ \hline
		\textbf{Type} & 1 & Integer & Message Type \\ \hline
		\textbf{Subtype} & 2 & Integer & Message Subtype \\ \hline
		\textbf{Status} & 3 & Integer & Response status \\ \hline
	\end{tabular}
	\caption{Header sections}
	\label{tab:header_sections}
\end{table}

\section{Payload}

Message \textit{payload} is optional. It uses \nameref{chap:custom_data_format} for data transmitting. \textit{Payload} can have variable length up to 9999999 bytes. The message \textit{payload} length is defined in the message \textit{header}, in case of empty payload zero value in the \textit{header} is set.

\chapter{Client Flow}

Each client has its own flow state, which is synchronized between server and client. It's used to show correct \ac{UI} screen to a player, to perform correct ping/get-state requests from a client, restrict or permit some user actions and to make a client able to continue from a state it was after reconnection (in case if the client is stored in server's cache). A client can be in four states: \textbf{No State}, \textbf{Menu}, \textbf{Login} and \textbf{Game}. Detailed description of client's states can be found in Table \ref{tab:client_flow_states}

\begin{table}[h]
	\centering
	\begin{tabular}{lp{325pt}}
	
		\textbf{No State} & If a client has no state, it means that login was not performed and a client state could not be fetched from a server. In this case a user is asked to login. \newline \\

		\textbf{Menu} & This state means, that the client is logged in, but has no lobby or game assigned. In this case open lobbies list is displayed to a user. Player can create a new lobby, or connect to am existing one. \newline \\

		\textbf{Lobby} & In this state client is assigned to a lobby, but game was not started. Lobby screen is displayed to a user. Player can leave the lobby, or start the game in case if he/she is a lobby host and there are enough players. \newline \\

		\textbf{Game} & In this state game is already started and client is participating it. User is allowed to make game moves or leave the game. If one of the game players leaves, the game is terminated for all players.

	\end{tabular}
	\caption{Client flow states.}
	\label{tab:client_flow_states}
\end{table}

\newpage

Some player actions (e.g. creating a new lobby or leaving current lobby) can affect current client flow state, which will lead to \ac{UI} changes. If the client state is changed on server side (e.g. game is terminated), then client-side flow state value is adjusted to ensure consistency with a server. Entire client flow overview can be seen in Figure \ref{fig:client_flow_overview}.

\begin{figure}[h!]
	\centering
	\begin{minipage}[b]{1.0\textwidth}
		\centering
		\includegraphics[width=\textwidth]{resources/client-flow.png}
    \end{minipage}
	\caption{Client flow overview.}
	\label{fig:client_flow_overview}
\end{figure}

\section{Edge Cases}

\begin{itemize}
	\item \textbf{Connection lost} - Loading screen with connection message is shown. Client attempts to reconnect to the server. After a successful reconnection, client performs auto-login with previously entered username a fetches user state from the server.
	\item \textbf{Game: opponent disconnected} - The message about game termination is shown. Client goes back to a menu state.
	\item \textbf{Game: opponent is offline} - The message about opponent's offline status is shown. A player can wait or press a quit button. In case of quit, game is terminated. 
\end{itemize}

\chapter{Requests and Responses}

In this chapter used client requests and server responses will be described. On some request types there can be more than one response type, \ac{HTTP}-like response codes are used to differentiate response processing.

Each request has its own type (see Table \ref{tab:request_types}) and subtype (see Table \ref{tab:request_subtypes}), which indicates how it should be processed on server. They are a mandatory part os a message header. 

\begin{table}[h!]
	\centering
	\begin{tabular}{|l|l|l|}
		\hline
		\textbf{Type} & \textbf{Code} & \textbf{Description} \\ \hline
		GET & 1 & Is used to retrieve information from a server. \\ \hline
		POST & 2 & Is used to change/post some information on a server. \\ \hline
	\end{tabular}
	\caption{Request types.}
	\label{tab:request_types}
\end{table}

\begin{table}[h!]
	\centering
	\begin{tabular}{|l|l|l|}
		\hline
		\textbf{Subtype} & \textbf{Code} & \textbf{Description} \\ \hline
		PING & 01 & Is used to ping a server. \\ \hline
		LOGIN & 02 & Is used to perform client login. \\ \hline
		CREATE\_GAME & 03 & Is used to perform creating a new game. \\ \hline
		LOBBY\_EXIT & 04 & Is used to exit a lobby or game. \\ \hline
		LOGOUT & 05 & Is used to perform client logout. \\ \hline
		START\_GAME & 06 & Is used to start a game. \\ \hline
		LOBBIES\_LIST & 07 & Is used to get open lobbies list. \\ \hline
		LOBBY\_CNCT & 08 & Is used to perform client connection to a lobby. \\ \hline
		GAME\_STATE & 09 & Is used to retrieve current game state. \\ \hline
		GAME\_MOVE & 10 & Is used to perform a player game move. \\ \hline
		LOBBY\_STATE & 11 & Is used to retrieve current lobby state. \\ \hline
		HANDSHAKE & 12 & Is used to perform a client-server handshake. \\ \hline
	\end{tabular}
	\caption{Request subtypes.}
	\label{tab:request_subtypes}
\end{table}


\section{Common}
These requests and responses are used when a client is not logged in or for performing actions with its login.

\subsection{Ping}
A simple ping request-response which is used to check if the server is online. Client request and server response structures can be seen in Table \ref{tab:ping_request_response}.

\begin{table}[h]
	\centering
	\begin{minipage}[b]{0.45\textwidth}
		\centering
		\begin{tabular}{|l|l|l|}
			\hline
			\textbf{Section} & \textbf{Value} & \textbf{Description} \\ \hline
			\textbf{Type} & 1 & \footnotesize{GET} \\ \hline
			\textbf{Subtype} & 01 & \footnotesize{PING} \\ \hline
		\end{tabular} \\
		\textit{Request header.}
	\end{minipage} 
	\hfill
	\begin{minipage}[b]{0.45\textwidth}
		\centering
		\begin{tabular}{|l|l|l|}
			\hline
			\textbf{Section} & \textbf{Value} & \textbf{Description} \\ \hline
			\textbf{Type} & 1 & \footnotesize{GET} \\ \hline
			\textbf{Subtype} & 01 & \footnotesize{PING} \\ \hline
			\textbf{Status} & 200 & \footnotesize{OK} \\ \hline
		\end{tabular} \\
		\textit{Response header.}
	\end{minipage} \newline

	\begin{minipage}[b]{0.45\textwidth}
		\centering
		\textit{Request payload is empty.}
	\end{minipage}	
	\hfill
	\begin{minipage}[b]{0.45\textwidth}
		\centering
		\textit{Response payload is empty.}
	\end{minipage}	
	\caption{Ping request/response.}
	\label{tab:ping_request_response}
\end{table}

\subsection{Handshake}
It is used to verify new client connection. If handshake was not performed, any other requests from client are aborted. Client request and server response structures can be seen in Table \ref{tab:handshake_request_response}.

\begin{table}[h]
	\centering
	\begin{minipage}[b]{0.45\textwidth}
		\centering
		\begin{tabular}{|l|l|l|}
			\hline
			\textbf{Section} & \textbf{Value} & \textbf{Description} \\ \hline
			\textbf{Type} & 2 & \footnotesize{POST} \\ \hline
			\textbf{Subtype} & 12 & \footnotesize{HANDSHAKE} \\ \hline
		\end{tabular} \\
		\textit{Request header.}
	\end{minipage} 
	\hfill
	\begin{minipage}[b]{0.45\textwidth}
		\centering
		\begin{tabular}{|l|l|l|}
			\hline
			\textbf{Section} & \textbf{Value} & \textbf{Description} \\ \hline
				\textbf{Type} & 2 & \footnotesize{POST} \\ \hline
			\textbf{Subtype} & 12 & \footnotesize{HANDSHAKE} \\ \hline
			\textbf{Status} & 200 & \footnotesize{OK} \\ \hline
		\end{tabular} \\
		\textit{Response header.}
	\end{minipage} \newline

	\begin{minipage}[b]{0.45\textwidth}
		\centering
		\textit{Request payload is empty.}
	\end{minipage}	
	\hfill
	\begin{minipage}[b]{0.45\textwidth}
		\centering
		\textit{Response payload is empty.}
	\end{minipage}	
	\caption{Handshake request/response.}
	\label{tab:handshake_request_response}
\end{table}

\newpage
\subsection{Login}
This request i subtype is used to perform client login (see Table \ref{tab:login_client_request}). If login is accepted by server, OK response is returned (see Table \ref{tab:login_server_response_ok}). Otherwise, if username is already in use, CONFLICT response is sent (see Table \ref{tab:login_server_response_nok}). 

\begin{table}[h]
	\centering
	\begin{minipage}[b]{0.45\textwidth}
		\centering
		\begin{tabular}{|l|l|l|}
			\hline
			\textbf{Section} & \textbf{Value} & \textbf{Description} \\ \hline
			\textbf{Type} & 2 & \footnotesize{POST} \\ \hline
			\textbf{Subtype} & 02 & \footnotesize{LOGIN} \\ \hline
		\end{tabular} \\
		\textit{Request header.}
	\end{minipage} 
	\hfill
	\begin{minipage}[b]{0.5\textwidth}
		\centering
		\begin{tabular}{|l|l|p{70pt}|}
			\hline
			\textbf{Field name} & \textbf{Type} & \textbf{Description} \\ \hline
			\textbf{username} & string & Username for login. \\ \hline
		\end{tabular} \\
		\textit{Request payload.}
	\end{minipage}	
	\caption{Login client request.}
	\label{tab:login_client_request}
\end{table}

\begin{table}[h]
	\centering
	\begin{minipage}[b]{0.45\textwidth}
		\centering
		\begin{tabular}{|l|l|l|}
			\hline
			\textbf{Section} & \textbf{Value} & \textbf{Description} \\ \hline
				\textbf{Type} & 2 & \footnotesize{POST} \\ \hline
			\textbf{Subtype} & 02 & \footnotesize{LOGIN} \\ \hline
			\textbf{Status} & 200 & \footnotesize{OK} \\ \hline
		\end{tabular} \\
		\textit{Response header.}
	\end{minipage} 
	\hfill
	\begin{minipage}[b]{0.5\textwidth}
		\centering
		\begin{tabular}{|l|l|p{70pt}|}
			\hline
			\textbf{Field name} & \textbf{Type} & \textbf{Description} \\ \hline
			\textbf{state} & string & Client flow state. \\ \hline
		\end{tabular} \\
		\textit{Response payload.}
	\end{minipage}	
	\caption{Login server response - OK.}
	\label{tab:login_server_response_ok}
\end{table}

\begin{table}[h]
	\centering
	\begin{minipage}[b]{0.45\textwidth}
		\centering
		\begin{tabular}{|l|l|l|}
			\hline
			\textbf{Section} & \textbf{Value} & \textbf{Description} \\ \hline
			\textbf{Type} & 2 & POST \\ \hline
			\textbf{Subtype} & 02 & \footnotesize{LOGIN} \\ \hline
			\textbf{Status} & 409 & \footnotesize{CONFLICT} \\ \hline
		\end{tabular} \\
		\textit{Response header.}
	\end{minipage} 
	\hfill
	\begin{minipage}[b]{0.5\textwidth}
		\centering
		\begin{tabular}{|l|l|p{70pt}|}
			\hline
			\textbf{Field name} & \textbf{Type} & \textbf{Description} \\ \hline
			\textbf{msg} & string & Error message. \\ \hline
			\textbf{state} & string & Client flow state. \\ \hline
		\end{tabular} \\
		\textit{Response payload.}
	\end{minipage}	
	\caption{Login server response - NOK - username declined.}
	\label{tab:login_server_response_nok}
\end{table}

\newpage

\subsection{Logout}

This request i subtype is used to perform client logout. If client is not logged in, no actions are performed and OK response is returned. Client request and server response can be seen in Table \ref{tab:logout_request_response} 

\begin{table}[h]
	\centering
	\begin{minipage}[b]{0.475\textwidth}
		\centering
		\begin{tabular}{|l|l|l|}
			\hline
			\textbf{Section} & \textbf{Value} & \textbf{Description} \\ \hline
			\textbf{Type} & 2 & \footnotesize{POST} \\ \hline
			\textbf{Subtype} & 05 & \footnotesize{LOGOUT} \\ \hline
		\end{tabular} \\
		\textit{Request header.}
	\end{minipage} 
	\hfill
	\begin{minipage}[b]{0.475\textwidth}
		\centering
		\begin{tabular}{|l|l|l|}
			\hline
			\textbf{Section} & \textbf{Value} & \textbf{Description} \\ \hline
			\textbf{Type} & 2 & \footnotesize{POST} \\ \hline
			\textbf{Subtype} & 05 & \footnotesize{LOGOUT} \\ \hline
			\textbf{Status} & 200 & \footnotesize{OK} \\ \hline
		\end{tabular} \\
		\textit{Response header.}
	\end{minipage} \newline

	\begin{minipage}[b]{0.475\textwidth}
		\centering
		\textit{Request payload is empty.}
	\end{minipage}	
	\hfill
	\begin{minipage}[b]{0.475\textwidth}
		\centering
		\textit{Response payload is empty.}
	\end{minipage}	
	\caption{Logout request/response.}
	\label{tab:logout_request_response}
\end{table}

\newpage

\section{Menu and Lobby}

These subtypes of requests are used to retrieve information about current lobbies state and to interact with a lobby.

\subsection{Retrieve Open Lobbies}

This request is used to get open lobbies, to which a client can connect (see Table \ref{tab:get_lobbies_request} and Table \ref{tab:get_lobbies_response}).

\begin{table}[h]
	\centering
	\begin{minipage}[b]{0.45\textwidth}
		\centering
		\begin{tabular}{|l|l|l|}
			\hline
			\textbf{Section} & \textbf{Value} & \textbf{Description} \\ \hline
			\textbf{Type} & 1 & \footnotesize{GET} \\ \hline
			\textbf{Subtype} & 07 & \footnotesize{LOBBIES\_LIST} \\ \hline
		\end{tabular} \\
		\textit{Request header.}
	\end{minipage} 
	\hfill
	\begin{minipage}[b]{0.45\textwidth}
		\centering
		\textit{Request payload is empty.}
	\end{minipage}	
	\caption{Get lobbies client request.}
	\label{tab:get_lobbies_request}
\end{table}

\begin{table}[h]
	\centering
	\begin{minipage}[b]{1.0\textwidth}
		\centering
		\begin{tabular}{|l|l|l|}
			\hline
			\textbf{Section} & \textbf{Value} & \textbf{Description} \\ \hline
			\textbf{Type} & 1 & \footnotesize{GET} \\ \hline
			\textbf{Subtype} & 07 & \footnotesize{LOBBIES\_LIST} \\ \hline
			\textbf{Status} & 200 & \footnotesize{OK} \\ \hline
		\end{tabular} \\
		\textit{Response header.}
	\end{minipage} \\
	\vspace{10pt}
	\begin{minipage}[b]{1.0\textwidth}
		\centering
		\begin{tabular}{|l|l|l|}
			\hline
			\textbf{Field name} & \textbf{Type} & \textbf{Description} \\ \hline
			\textbf{state} & string & Client flow state for synchronization. \\ \hline
			\textbf{lobbies} & string array & A list of open lobbies names. \\ \hline
			\textbf{lobby\_hosts} & string array & A list of open lobbies host usernames. \\ \hline
		\end{tabular} \\
		\textit{Response payload.}
	\end{minipage}	
	\caption{Get lobbies server response.}
	\label{tab:get_lobbies_response}
\end{table}

\newpage

\subsection{Create Lobby}

This request is used to process new lobby creation, triggered by a user. Client sends a request with a lobby name (see Table \ref{tab:create_lobby_request}). Server respond with OK if a lobby is created successfully (see Table \ref{tab:create_lobby_response_OK}), and with status CONFLICT if a lobby with requested name is already exists (see Table \ref{tab:create_lobby_request_conflict}).

\begin{table}[h!]
	\centering
	\begin{minipage}[b]{0.45\textwidth}
		\centering
		\begin{tabular}{|l|l|l|}
			\hline
			\textbf{Section} & \textbf{Value} & \textbf{Description} \\ \hline
			\textbf{Type} & 2 & \footnotesize{POST} \\ \hline
			\textbf{Subtype} & 03 & \footnotesize{CREATE\_GAME}  \\ \hline
		\end{tabular} \\
		\textit{Request header.}
	\end{minipage} 
	\hfill
	\begin{minipage}[b]{0.5\textwidth}
		\centering
		\begin{tabular}{|l|l|p{70pt}|}
			\hline
			\textbf{Field name} & \textbf{Type} & \textbf{Description} \\ \hline
			\textbf{name} & string & Lobby name. \\ \hline
		\end{tabular} \\
		\textit{Request payload.}
	\end{minipage}	
	\caption{Create lobby client request.}
	\label{tab:create_lobby_request}
\end{table}

\begin{table}[h!]
	\centering
	\begin{minipage}[b]{1.0\textwidth}
		\centering
		\begin{tabular}{|l|l|l|}
			\hline
			\textbf{Section} & \textbf{Value} & \textbf{Description} \\ \hline
			\textbf{Type} & 2 & \footnotesize{POST} \\ \hline
			\textbf{Subtype} & 03 & \footnotesize{CREATE\_GAME}  \\ \hline
			\textbf{Status} & 200 & \footnotesize{OK} \\ \hline
		\end{tabular} \\
		\textit{Response header.}
	\end{minipage} 
	\\
	\vspace{10pt}
	\begin{minipage}[b]{1.0\textwidth}
		\centering
		\begin{tabular}{|l|l|l|}
			\hline
			\textbf{Field name} & \textbf{Type} & \textbf{Description} \\ \hline
			\textbf{state} & string & Client flow state for synchronization. \\ \hline
			\textbf{name} & string & Lobby name. \\ \hline
			\textbf{user} & string & Client name. \\ \hline
		\end{tabular} \\
		\textit{Response payload.}
	\end{minipage}	
	\caption{Create lobby server response - OK.}
	\label{tab:create_lobby_response_OK}
\end{table}

\begin{table}[h!]
	\centering
	\begin{minipage}[b]{1.0\textwidth}
		\centering
		\begin{tabular}{|l|l|l|}
			\hline
			\textbf{Section} & \textbf{Value} & \textbf{Description} \\ \hline
			\textbf{Type} & 2 & \footnotesize{POST} \\ \hline
			\textbf{Subtype} & 03 & \footnotesize{CREATE\_GAME}  \\ \hline
			\textbf{Status} & 409 & \footnotesize{CONFLICT} \\ \hline
		\end{tabular} \\
		\textit{Response header.}
	\end{minipage} 
	\\
	\vspace{10pt}
	\begin{minipage}[b]{1.0\textwidth}
		\centering
		\begin{tabular}{|l|l|l|}
			\hline
			\textbf{Field name} & \textbf{Type} & \textbf{Description} \\ \hline
			\textbf{msg} & string & Error message. \\ \hline
			\textbf{state} & string & Client flow state for synchronization. \\ \hline
		\end{tabular} \\
		\textit{Response payload.}
	\end{minipage}	
	\caption{Create lobby server response - CONFLICT.}
	\label{tab:create_lobby_request_conflict}
\end{table}

\newpage

\subsection{Connect to Lobby}

This request subtype is used to perform client connection to an existing open lobby (see Table \ref{tab:connect_lobby_request}). If connection was successful, OK response is returned (see Table \ref{tab:connect_lobby_response_ok}), otherwise, if connection was not performed, NOT FOUND response is returned (see Table \ref{tab:connect_lobby_response_not_found}).

\begin{table}[h!]
	\centering
	\begin{minipage}[b]{0.45\textwidth}
		\centering
		\begin{tabular}{|l|l|l|}
			\hline
			\textbf{Section} & \textbf{Value} & \textbf{Description} \\ \hline
			\textbf{Type} & 2 & \footnotesize{POST} \\ \hline
			\textbf{Subtype} & 08 & \footnotesize{LOBBY\_CNCT}  \\ \hline
		\end{tabular} \\
		\textit{Request header.}
	\end{minipage} 
	\hfill
	\begin{minipage}[b]{0.5\textwidth}
		\centering
		\begin{tabular}{|l|l|p{70pt}|}
			\hline
			\textbf{Field name} & \textbf{Type} & \textbf{Description} \\ \hline
			\textbf{lobby} & string & Lobby name. \\ \hline
		\end{tabular} \\
		\textit{Request payload.}
	\end{minipage}	
	\caption{Connect to lobby client request.}
	\label{tab:connect_lobby_request}
\end{table}

\begin{table}[h!]
	\centering
	\begin{minipage}[b]{1.0\textwidth}
		\centering
		\begin{tabular}{|l|l|l|}
			\hline
			\textbf{Section} & \textbf{Value} & \textbf{Description} \\ \hline
			\textbf{Type} & 2 & \footnotesize{POST} \\ \hline
			\textbf{Subtype} & 08 & \footnotesize{LOBBY\_CNCT}  \\ \hline
			\textbf{Status} & 200 & \footnotesize{OK} \\ \hline
		\end{tabular} \\
		\textit{Response header.}
	\end{minipage} 
	\\
	\vspace{10pt}
	\begin{minipage}[b]{1.0\textwidth}
		\centering
		\begin{tabular}{|l|l|l|}
			\hline
			\textbf{Field name} & \textbf{Type} & \textbf{Description} \\ \hline
			\textbf{state} & string & Client flow state for synchronization. \\ \hline
			\textbf{lobby} & string & Lobby name. \\ \hline
			\textbf{host} & string & Host name. \\ \hline
			\textbf{players} & string array & Players names list. \\ \hline
		\end{tabular} \\
		\textit{Response payload.}
	\end{minipage}	
	\caption{Connect to lobby server response - OK.}
	\label{tab:connect_lobby_response_ok}
\end{table}

\begin{table}[h!]
	\centering
	\begin{minipage}[b]{1.0\textwidth}
		\centering
		\begin{tabular}{|l|l|l|}
			\hline
			\textbf{Section} & \textbf{Value} & \textbf{Description} \\ \hline
			\textbf{Type} & 2 & \footnotesize{POST} \\ \hline
			\textbf{Subtype} & 08 & \footnotesize{LOBBY\_CNCT}  \\ \hline
			\textbf{Status} & 404 & \footnotesize{NOT FOUND} \\ \hline
		\end{tabular} \\
		\textit{Response header.}
	\end{minipage} 
	\\
	\vspace{10pt}
	\begin{minipage}[b]{1.0\textwidth}
		\centering
		\begin{tabular}{|l|l|l|}
			\hline
			\textbf{Field name} & \textbf{Type} & \textbf{Description} \\ \hline
			\textbf{msg} & string & Error message. \\ \hline
			\textbf{state} & string & Client flow state for synchronization. \\ \hline
			\textbf{lobby} & string & Lobby name. \\ \hline
		\end{tabular} \\
		\textit{Response payload.}
	\end{minipage}	
	\caption{Connect to lobby server response - NOT FOUND.}
	\label{tab:connect_lobby_response_not_found}
\end{table}

\newpage

\subsection{Get Lobby State}

This request is used to get current state of the lobby, in which client is (see Table \ref{tab:get_lobby_state_request}). If state is retrieved successfully, then OK response is returned (see Table \ref{tab:get_lobby_state_response_ok}). In case when the game is started, REDIRECT response is used (see Table \ref{tab:get_lobby_state_response_redirect}).

\begin{table}[h!]
	\centering
	\begin{minipage}[b]{0.45\textwidth}
		\centering
		\begin{tabular}{|l|l|l|}
			\hline
			\textbf{Section} & \textbf{Value} & \textbf{Description} \\ \hline
			\textbf{Type} & 1 & \footnotesize{GET} \\ \hline
			\textbf{Subtype} & 11 & \footnotesize{LOBBY\_STATE}  \\ \hline
		\end{tabular} \\
		\textit{Request header.}
	\end{minipage} 
	\hfill
	\begin{minipage}[b]{0.5\textwidth}
		\centering
		\textit{Request payload is empty.}
	\end{minipage}	
	\caption{Get lobby state client request.}
	\label{tab:get_lobby_state_request}
\end{table}

\begin{table}[h!]
	\centering
	\begin{minipage}[b]{1.0\textwidth}
		\centering
		\begin{tabular}{|l|l|l|}
			\hline
			\textbf{Section} & \textbf{Value} & \textbf{Description} \\ \hline
			\textbf{Type} & 1 & \footnotesize{GET} \\ \hline
			\textbf{Subtype} & 11 & \footnotesize{LOBBY\_STATE}  \\ \hline
			\textbf{Status} & 200 & \footnotesize{OK} \\ \hline
		\end{tabular} \\
		\textit{Response header.}
	\end{minipage} 
	\\
	\vspace{10pt}
	\begin{minipage}[b]{1.0\textwidth}
		\centering
		\begin{tabular}{|l|l|l|}
			\hline
			\textbf{Field name} & \textbf{Type} & \textbf{Description} \\ \hline
			\textbf{state} & string & Client flow state for synchronization. \\ \hline
			\textbf{lobby} & string & Lobby name. \\ \hline
			\textbf{host} & string & Host name. \\ \hline
			\textbf{players} & string array & Players names list. \\ \hline
		\end{tabular} \\
		\textit{Response payload.}
	\end{minipage}	
	\caption{Get lobby state server response - OK.}
	\label{tab:get_lobby_state_response_ok}
\end{table}

\begin{table}[h!]
	\centering
	\begin{minipage}[b]{1.0\textwidth}
		\centering
		\begin{tabular}{|l|l|l|}
			\hline
			\textbf{Section} & \textbf{Value} & \textbf{Description} \\ \hline
			\textbf{Type} & 1 & \footnotesize{GET} \\ \hline
			\textbf{Subtype} & 11 & \footnotesize{LOBBY\_STATE}  \\ \hline
			\textbf{Status} & 301 & \footnotesize{MOVED} \\ \hline
		\end{tabular} \\
		\textit{Response header.}
	\end{minipage} 
	\\
	\vspace{10pt}
	\begin{minipage}[b]{1.0\textwidth}
		\centering
		\begin{tabular}{|l|l|l|}
			\hline
			\textbf{Field name} & \textbf{Type} & \textbf{Description} \\ \hline
			\textbf{state} & string & Client flow state for synchronization. \\ \hline
			\textbf{lobby} & string & Lobby name. \\ \hline
			\textbf{host} & string & Host name. \\ \hline
			\textbf{players} & string array & Players names list. \\ \hline
		\end{tabular} \\
		\textit{Response payload.}
	\end{minipage}	
	\caption{Get lobby state server response - REDIRECT.}
	\label{tab:get_lobby_state_response_redirect}
\end{table}

\newpage

\subsection{Start the Game}

This request is used to start the game from the current lobby (see Table \ref{tab:start_game_request}). If game is started successfully, then OK response is returned (see Table \ref{tab:start_game_response_ok}). If the lobby has not enough players to start the game, NOT ALLOWED response is returned (see Table \ref{tab:start_game_response_not_allowed}). If the current player has no rights to start the game (e.g. not the host), UNAUTHORIZED response is used (see Table \ref{tab:start_game_response_unauthorized}).

\begin{table}[h!]
	\centering
	\begin{minipage}[b]{0.45\textwidth}
		\centering
		\begin{tabular}{|l|l|l|}
			\hline
			\textbf{Section} & \textbf{Value} & \textbf{Description} \\ \hline
			\textbf{Type} & 2 & \footnotesize{POST} \\ \hline
			\textbf{Subtype} & 06 & \footnotesize{START\_GAME}  \\ \hline
		\end{tabular} \\
		\textit{Request header.}
	\end{minipage} 
	\hfill
	\begin{minipage}[b]{0.5\textwidth}
		\centering
		\textit{Request payload is empty.}
	\end{minipage}	
	\caption{Start the game client request.}
	\label{tab:start_game_request}
\end{table}

\begin{table}[h!]
	\centering
	\begin{minipage}[b]{1.0\textwidth}
		\centering
		\begin{tabular}{|l|l|l|}
			\hline
			\textbf{Section} & \textbf{Value} & \textbf{Description} \\ \hline
			\textbf{Type} & 2 & \footnotesize{POST} \\ \hline
			\textbf{Subtype} & 06 & \footnotesize{START\_GAME}  \\ \hline
			\textbf{Status} & 200 & \footnotesize{OK} \\ \hline
		\end{tabular} \\
		\textit{Response header.}
	\end{minipage} 
	\\
	\vspace{10pt}
	\begin{minipage}[b]{1.0\textwidth}
		\centering
		\begin{tabular}{|l|l|l|}
			\hline
			\textbf{Field name} & \textbf{Type} & \textbf{Description} \\ \hline
			\textbf{state} & string & Client flow state for synchronization. \\ \hline
		\end{tabular} \\
		\textit{Response payload.}
	\end{minipage}	
	\caption{Start the game server response - OK.}
	\label{tab:start_game_response_ok}
\end{table}

\begin{table}[h!]
	\centering
	\begin{minipage}[b]{1.0\textwidth}
		\centering
		\begin{tabular}{|l|l|l|}
			\hline
			\textbf{Section} & \textbf{Value} & \textbf{Description} \\ \hline
			\textbf{Type} & 2 & \footnotesize{POST} \\ \hline
			\textbf{Subtype} & 06 & \footnotesize{START\_GAME}  \\ \hline
			\textbf{Status} & 405 & \footnotesize{NOT\_ALLOWED} \\ \hline
		\end{tabular} \\
		\textit{Response header.}
	\end{minipage} 
	\\
	\vspace{10pt}
	\begin{minipage}[b]{1.0\textwidth}
		\centering
		\begin{tabular}{|l|l|l|}
			\hline
			\textbf{Field name} & \textbf{Type} & \textbf{Description} \\ \hline
            \textbf{msg} & string & Error message. \\ \hline
			\textbf{state} & string & Client flow state for synchronization. \\ \hline
            \textbf{players} & string array & Players names list. \\ \hline
		\end{tabular} \\
		\textit{Response payload.}
	\end{minipage}	
	\caption{Start the game server response - NOT ALLOWED.}
	\label{tab:start_game_response_not_allowed}
\end{table}

\begin{table}[h!]
	\centering
	\begin{minipage}[b]{1.0\textwidth}
		\centering
		\begin{tabular}{|l|l|l|}
			\hline
			\textbf{Section} & \textbf{Value} & \textbf{Description} \\ \hline
			\textbf{Type} & 2 & \footnotesize{POST} \\ \hline
			\textbf{Subtype} & 06 & \footnotesize{START\_GAME}  \\ \hline
			\textbf{Status} & 401 & \footnotesize{UNAUTHORIZED} \\ \hline
		\end{tabular} \\
		\textit{Response header.}
	\end{minipage} 
	\\
	\vspace{10pt}
	\begin{minipage}[b]{1.0\textwidth}
		\centering
		\begin{tabular}{|l|l|l|}
			\hline
			\textbf{Field name} & \textbf{Type} & \textbf{Description} \\ \hline
            \textbf{msg} & string & Error message. \\ \hline
			\textbf{state} & string & Client flow state for synchronization. \\ \hline
            \textbf{players} & string array & Players names list. \\ \hline
		\end{tabular} \\
		\textit{Response payload.}
	\end{minipage}	
	\caption{Start the game server response - NOT ALLOWED.}
	\label{tab:start_game_response_unauthorized}
\end{table}

\newpage

\subsection{Exit the Lobby}

This request subtype is used to perform a player exiting the lobby or game (see Table \ref{tab:exit_lobby_request}). The only response is OK (see Table \ref{exit_lobby_response_ok}), which indicates that operation was successful.

\begin{table}[h!]
	\centering
	\begin{minipage}[b]{0.45\textwidth}
		\centering
		\begin{tabular}{|l|l|l|}
			\hline
			\textbf{Section} & \textbf{Value} & \textbf{Description} \\ \hline
			\textbf{Type} & 2 & \footnotesize{POST} \\ \hline
			\textbf{Subtype} & 04 & \footnotesize{LOBBY\_EXIT}  \\ \hline
		\end{tabular} \\
		\textit{Request header.}
	\end{minipage} 
	\hfill
	\begin{minipage}[b]{0.5\textwidth}
		\centering
		\textit{Request payload is empty.}
	\end{minipage}	
	\caption{Exit the lobby client request.}
	\label{tab:exit_lobby_request}
\end{table}

\begin{table}[h!]
	\centering
	\begin{minipage}[b]{1.0\textwidth}
		\centering
		\begin{tabular}{|l|l|l|}
			\hline
			\textbf{Section} & \textbf{Value} & \textbf{Description} \\ \hline
			\textbf{Type} & 2 & \footnotesize{POST} \\ \hline
			\textbf{Subtype} & 04 & \footnotesize{EXIT\_LOBBY}  \\ \hline
			\textbf{Status} & 200 & \footnotesize{OK} \\ \hline
		\end{tabular} \\
		\textit{Response header.}
	\end{minipage} 
	\\
	\vspace{10pt}
	\begin{minipage}[b]{1.0\textwidth}
		\centering
		\begin{tabular}{|l|l|l|}
			\hline
			\textbf{Field name} & \textbf{Type} & \textbf{Description} \\ \hline
			\textbf{state} & string & Client flow state for synchronization. \\ \hline
		\end{tabular} \\
		\textit{Response payload.}
	\end{minipage}	
	\caption{Exit the lobby server response - OK.}
	\label{tab:exit_lobby_response_ok}
\end{table}

\newpage

\section{Game}
These requests are used to retrieve information about the current game state and to perform player actions with it.

\newpage

\subsection{Get Game State}
This request is used to retrieve the current game state (see Table \ref{tab:get_game_state_request}). If the game state can be get, OK response is returned with game state information (see Table \ref{tab:get_game_state_response_ok}). In case if the game is over, RESET response is returned with information about a winner (see Table \ref{tab:get_game_state_response_reset}). If the game is terminated (one of the players exited the game), then MOVED PERMANENTLY response is returned (see Table \ref{tab:get_game_state_response_moved}). If a player is trying to get a state of a game which is not started yet, NOT FOUND response is returned (see Table \ref{tab:get_game_state_response_not_found}).

\begin{table}[h!]
	\centering
	\begin{minipage}[b]{0.45\textwidth}
		\centering
		\begin{tabular}{|l|l|l|}
			\hline
			\textbf{Section} & \textbf{Value} & \textbf{Description} \\ \hline
			\textbf{Type} & 2 & \footnotesize{POST} \\ \hline
			\textbf{Subtype} & 09 & \footnotesize{GAME\_STATE}  \\ \hline
		\end{tabular} \\
		\textit{Request header.}
	\end{minipage} 
	\hfill
	\begin{minipage}[b]{0.5\textwidth}
		\centering
		\textit{Request payload is empty.}
	\end{minipage}	
	\caption{Get game state client request.}
	\label{tab:get_game_state_request}
\end{table}

\begin{table}[h!]
	\centering
	\begin{minipage}[b]{1.0\textwidth}
		\centering
		\begin{tabular}{|l|l|l|}
			\hline
			\textbf{Section} & \textbf{Value} & \textbf{Description} \\ \hline
			\textbf{Type} & 2 & \footnotesize{POST} \\ \hline
			\textbf{Subtype} & 09 & \footnotesize{GAME\_STATE}  \\ \hline
			\textbf{Status} & 200 & \footnotesize{OK} \\ \hline
		\end{tabular} \\
		\textit{Response header.}
	\end{minipage} 
	\\
	\vspace{10pt}
	\begin{minipage}[b]{1.0\textwidth}
		\centering
		\begin{tabular}{|l|l|l|}
			\hline
			\textbf{Field name} & \textbf{Type} & \textbf{Description} \\ \hline
			\textbf{state} & string & Client flow state for synchronization. \\ \hline
            \textbf{players} & string array & Players names list. \\ \hline
            \textbf{player\_codes} & string array & Player codes list. \\ \hline
            \textbf{opponent\_connected} & bool & Shows if opponent has a connection to the server. \\ \hline
            \textbf{current\_player} & string & Name of the player who is on turn. \\ \hline
            \textbf{board} & integer array & Board cells representation. \\ \hline
            \textbf{board\_size} & integer array & board size [cols, rows]. \\ \hline
		\end{tabular} \\
		\textit{Response payload.}
	\end{minipage}	
	\caption{Get game state server response - OK.}
	\label{tab:get_game_state_response_ok}
\end{table}

\newpage

\begin{table}[h!]
	\centering
	\begin{minipage}[b]{1.0\textwidth}
		\centering
		\begin{tabular}{|l|l|l|}
			\hline
			\textbf{Section} & \textbf{Value} & \textbf{Description} \\ \hline
			\textbf{Type} & 2 & \footnotesize{POST} \\ \hline
			\textbf{Subtype} & 09 & \footnotesize{GAME\_STATE}  \\ \hline
			\textbf{Status} & 205 & \footnotesize{RESET} \\ \hline
		\end{tabular} \\
		\textit{Response header.}
	\end{minipage} 
	\\
	\vspace{10pt}
	\begin{minipage}[b]{1.0\textwidth}
		\centering
		\begin{tabular}{|l|l|l|}
			\hline
			\textbf{Field name} & \textbf{Type} & \textbf{Description} \\ \hline
			\textbf{state} & string & Client flow state for synchronization. \\ \hline
            \textbf{players} & string array & Players names list. \\ \hline
            \textbf{winner} & string & Name of the game winner. \\ \hline
		\end{tabular} \\
		\textit{Response payload.}
	\end{minipage}	
	\caption{Exit the lobby server response - RESET.}
	\label{tab:get_game_state_response_reset}
\end{table}

\begin{table}[h!]
	\centering
	\begin{minipage}[b]{1.0\textwidth}
		\centering
		\begin{tabular}{|l|l|l|}
			\hline
			\textbf{Section} & \textbf{Value} & \textbf{Description} \\ \hline
			\textbf{Type} & 2 & \footnotesize{POST} \\ \hline
			\textbf{Subtype} & 09 & \footnotesize{GAME\_STATE}  \\ \hline
			\textbf{Status} & 301 & \footnotesize{MOVED\_PERMANENTLY} \\ \hline
		\end{tabular} \\
		\textit{Response header.}
	\end{minipage} 
	\\
	\vspace{10pt}
	\begin{minipage}[b]{1.0\textwidth}
		\centering
		\begin{tabular}{|l|l|l|}
			\hline
			\textbf{Field name} & \textbf{Type} & \textbf{Description} \\ \hline
			\textbf{state} & string & Client flow state for synchronization. \\ \hline
            \textbf{msg} & string & User message. \\ \hline
		\end{tabular} \\
		\textit{Response payload.}
	\end{minipage}	
	\caption{Exit the lobby server response - MOVED.}
	\label{tab:get_game_state_response_moved}
\end{table}

\begin{table}[h!]
	\centering
	\begin{minipage}[b]{1.0\textwidth}
		\centering
		\begin{tabular}{|l|l|l|}
			\hline
			\textbf{Section} & \textbf{Value} & \textbf{Description} \\ \hline
			\textbf{Type} & 2 & \footnotesize{POST} \\ \hline
			\textbf{Subtype} & 09 & \footnotesize{GAME\_STATE}  \\ \hline
			\textbf{Status} & 404 & \footnotesize{NOT\_FOUND} \\ \hline
		\end{tabular} \\
		\textit{Response header.}
	\end{minipage} 
	\\
	\vspace{10pt}
	\begin{minipage}[b]{1.0\textwidth}
		\centering
		\begin{tabular}{|l|l|l|}
			\hline
			\textbf{Field name} & \textbf{Type} & \textbf{Description} \\ \hline
			\textbf{state} & string & Client flow state for synchronization. \\ \hline
            \textbf{msg} & string & User message. \\ \hline
		\end{tabular} \\
		\textit{Response payload.}
	\end{minipage}	
	\caption{Exit the lobby server response - NOT FOUND.}
	\label{tab:get_game_state_response_not_found}
\end{table}

\newpage

\subsection{Player Move}
This request subtype is used to perform player move in a game (see Table \ref{tab:player_move_request}). If the move was successful, then OK response is used (see Table \ref{tab:player_move_response_ok}). If the player is not on turn, CONFLICT response is returned (see Table \ref{tab:player_move_response_conflict}). In case when the move is invalid, NOT ALLOWED response is used (see Table \ref{tab:player_move_response__not_allowed}).

\begin{table}[h!]
	\centering
	\begin{minipage}[b]{1.0\textwidth}
		\centering
		\begin{tabular}{|l|l|l|}
			\hline
			\textbf{Section} & \textbf{Value} & \textbf{Description} \\ \hline
			\textbf{Type} & 2 & \footnotesize{POST} \\ \hline
			\textbf{Subtype} & 10 & \footnotesize{GAME\_MOVE}  \\ \hline
		\end{tabular} \\
		\textit{Request header.}
	\end{minipage} 
	\\
	\vspace{10pt}
	\begin{minipage}[b]{1.0\textwidth}
		\centering
		\begin{tabular}{|l|l|l|}
			\hline
			\textbf{Field name} & \textbf{Type} & \textbf{Description} \\ \hline
			\textbf{x} & integer & X coordinate of the move. \\ \hline
            \textbf{y} & integer & Y coordinate of the move. \\ \hline
		\end{tabular} \\
		\textit{Request payload.}
	\end{minipage}	
	\caption{Player move client request.}
	\label{tab:player_move_request}
\end{table}

\begin{table}[h!]
	\centering
	\begin{minipage}[b]{1.0\textwidth}
		\centering
		\begin{tabular}{|l|l|l|}
			\hline
			\textbf{Section} & \textbf{Value} & \textbf{Description} \\ \hline
			\textbf{Type} & 2 & \footnotesize{POST} \\ \hline
			\textbf{Subtype} & 09 & \footnotesize{GAME\_STATE}  \\ \hline
			\textbf{Status} & 200 & \footnotesize{OK} \\ \hline
		\end{tabular} \\
		\textit{Response header.}
	\end{minipage} 
	\\
	\vspace{10pt}
	\begin{minipage}[b]{1.0\textwidth}
		\centering
		\begin{tabular}{|l|l|l|}
			\hline
			\textbf{Field name} & \textbf{Type} & \textbf{Description} \\ \hline
			\textbf{x} & integer & X coordinate of the move. \\ \hline
            \textbf{y} & integer & Y coordinate of the move. \\ \hline
		\end{tabular} \\
		\textit{Response payload.}
	\end{minipage}	
	\caption{Player server response - OK.}
	\label{tab:player_move_response_ok}
\end{table}

\begin{table}[h!]
	\centering
	\begin{minipage}[b]{1.0\textwidth}
		\centering
		\begin{tabular}{|l|l|l|}
			\hline
			\textbf{Section} & \textbf{Value} & \textbf{Description} \\ \hline
			\textbf{Type} & 2 & \footnotesize{POST} \\ \hline
			\textbf{Subtype} & 09 & \footnotesize{GAME\_STATE}  \\ \hline
			\textbf{Status} & 409 & \footnotesize{CONFLICT} \\ \hline
		\end{tabular} \\
		\textit{Response header.}
	\end{minipage} 
	\\
	\vspace{10pt}
	\begin{minipage}[b]{1.0\textwidth}
		\centering
		\begin{tabular}{|l|l|l|}
			\hline
			\textbf{Field name} & \textbf{Type} & \textbf{Description} \\ \hline
			\textbf{state} & string & Client flow state for synchronization. \\ \hline
            \textbf{msg} & string & User message. \\ \hline
		\end{tabular} \\
		\textit{Response payload.}
	\end{minipage}	
	\caption{Player server response - CONFLICT.}
	\label{tab:player_move_response_conflict}
\end{table}

\begin{table}[h!]
	\centering
	\begin{minipage}[b]{1.0\textwidth}
		\centering
		\begin{tabular}{|l|l|l|}
			\hline
			\textbf{Section} & \textbf{Value} & \textbf{Description} \\ \hline
			\textbf{Type} & 2 & \footnotesize{POST} \\ \hline
			\textbf{Subtype} & 09 & \footnotesize{GAME\_STATE}  \\ \hline
			\textbf{Status} & 405 & \footnotesize{NOT\_ALLOWED} \\ \hline
		\end{tabular} \\
		\textit{Response header.}
	\end{minipage}
	\\
	\vspace{10pt}
	\begin{minipage}[b]{1.0\textwidth}
		\centering
		\begin{tabular}{|l|l|l|}
			\hline
			\textbf{Field name} & \textbf{Type} & \textbf{Description} \\ \hline
			\textbf{state} & string & Client flow state for synchronization. \\ \hline
            \textbf{msg} & string & User message. \\ \hline
		\end{tabular} \\
		\textit{Response payload.}
	\end{minipage}	
	\caption{Player server response - NOT ALLOWED.}
	\label{tab:player_move_response__not_allowed}
\end{table}
\newpage

\chapter{Server}

Server is written in C++ 17 along with \texttt{CMake} build system and utility packages (\texttt{log4cxx}, \texttt{fmt} and \texttt{SimpleIni}). These tools were chosen to simplify memory management (utilizing \texttt{std::shared\_ptr}) and to enable working in the object-oriented programming paradigm.

\newpage
\section{Project Structure}
The implementation of the program consists of several modules to achieve greater flexibility in supporting or modifying the code. The following briefly shows project structure:
\\
\begin{dirtree}{%
	.1 src.
	.2 main.
	.3 cpp.
	.4 base.
	.4 config.
	.4 utils.
	.4 reversi.
	.5 board.
	.5 config.
	.5 consts.
	.5 engine.
	.4 server.
	.5 connection.
	.6 consts.
	.6 message.
	.7 enums.
	.7 header.
	.7 payload.
	.5 managers.
	.5 config.
	.4 game.
	.5 lobby.
	.5 player.
	}
\end{dirtree}

\newpage
\section{Key Implementations}

\subsection{Main Function}
Program entry point - \texttt{main.cpp} file. Main function takes care of loading all needed configuration from \texttt{.ini} files, initializes logging and server. Starts the server.

\subsection{Server}
Server class implementation encapsulates the key functionalities required to manage server operations in a networked application. The server is initialized with configuration details (\texttt{server\_config}) and a message manager (\texttt{message\_manager}) and verifies that all required configurations are in place before starting.

\textbf{Server} creates a socket to listen for incoming connections. Binds the socket to the specified address and port and listens for client connections and manages the connection queue size. Accepts incoming client connections and manages individual client threads. Processes client messages and handles the exchange of requests and responses. Closes client connections when necessary, including during timeouts or errors. Handles scenarios where clients disconnect or time out, ensuring the server resources are released properly. Monitors client activity and disconnects idle or unresponsive clients. Integrates with client and lobby managers to manage game-specific or application-specific states.

\subsection{Client Manager}
\textbf{Client Manager} class provides core functionalities to manage client connections and their states on the server. It takes care of storing a new client connection in a connection map and removing client connections safely when they are no longer active. Provides functionality for clients login and logout. Ensures thread-safe access to client connections and client data using shared and unique locks for read and write operations. The \textbf{Client Manager} class plays a critical role in maintaining the integrity and thread-safety of client-related data and ensuring seamless interaction between the server and its clients.

\subsection{Lobby Manager}
The \textbf{Lobby Manager} class is responsible for managing lobbies and their interactions with clients in a multiplayer environment. It's responsible for creating a new lobby with a specified name and ensuring that the provided lobby name is unique. It allows players to exit lobbies. If the host leaves, it updates the host or removes the lobby if it becomes empty. Also it updates the player's state to reflect their disconnection from the lobby. 

\subsection{Message Manager}
The \textbf{Message Manager} class is a core component responsible for processing and managing communication between clients and the server. It handles incoming messages from clients and routes them based on their type and subtype. Ensures handshake and login are performed before processing certain requests. Validates message identifiers to ensure requests are from authorized sources. Generates appropriate error responses for invalid requests, unauthorized actions, and resource conflicts. 

\section{How to Build and Run}

\subsection{Requirements}
To build the server executable file next components are required:
\begin{itemize}
	\item \textbf{\texttt{Linux OS}} -- the server can be build only under \texttt{GNU/Linux} operation system.
	\item \textbf{\texttt{C++ 17+}} -- Installed and configured \texttt{C++} of version 17 or higher is required.
	\item \textbf{\texttt{CMake 3.25+}} -- Installed and configured \texttt{CMake} of version 3.25 or higher is required.
	\item \textbf{\texttt{log4cxx}} -- Installed \texttt{liblog4cxx-dev} package is required.
\end{itemize}

\subsection{Build and Run}
The project can be build using common way of building CMake projects and run by executing \texttt{server} executable file after the build. The process is described in the listing \ref{lst:server_build}.

\begin{lstlisting}[language=bash, caption={Example server build and run}, label={lst:server_build}]
# Navigate to the project directory
cd project
	
# Create a build directory
mkdir build && cd build
	
# Configure the project
cmake ..
	
# Build the project
make
	
# Run the executable
./server
\end{lstlisting}

\subsection{Configuration}
Server specific parameters such as port, client and handshake timeouts etc. can be configured using \texttt{config.ini} file located in the \texttt{config} folder in the project root.

\chapter{Client}
The client application implementation is developed in \texttt{Kotlin} language together with \texttt{Kotlin Multiplatform} and \texttt{Compose Multiplatform} frameworks. Also, the implementation relies on \texttt{koin} dependency injection library. Such development stack was chosen because it's easy to maintain and extend with a new features. Mentioned frameworks provides a mechanism for fast project migration to other platforms such as \texttt{Android}, \texttt{IOS} and \texttt{WEB} while sharing common \ac{UI} and business logic implementation. Also, \texttt{Compose Multiplatform} allows developers to use modern \texttt{Android-style} \ac{UI} implementation with a variety of pre-made features.

\section{Project Structure}
The project implementation is divided into two main parts:
\begin{itemize}
	\item \textbf{\texttt{commonMain}} -- contains implementation of common business logic and \ac{UI} which can be used on different platforms.
	\item \textbf{\texttt{desktopMain}} -- contains desktop \texttt{Linux} specific implementation such as running the \texttt{Compose Application}.    
\end{itemize}

This structure ensures easy maintain of the project and its flexibility from platform and new features perspective.

\section{Key Implementations}

The whole project is written in \ac{MVVM} paradigm to provide a clear separation of concerns and facilitates testability, maintainability, and scalability.

\subsection{Modules}
The \textbf{Modules.kt} file contains \texttt{koin} modules declaration and provides dependency injection support to the project. It ensures correct \texttt{koin} initialization with provided parameters which allows adaptation of used dependencies without any code changes.

\subsection{State Services}
State services are used to encapsulate a state, to provide a unified interface to interact with the state and its thread-safety. The following state services are present in the project:
\begin{itemize}
	\item \textbf{ClientStateService} -- encapsulates the client state such as login state, username, current flow state, available lobbies list and the current lobby.
	\item \textbf{ConnectionStateService} -- encapsulates the server connection state and stores information if the connection is alive, last successful server ping timestamp, socket, and if a handshake was performed.
	\item \textbf{GameStateService} -- contains information about the current game state: players list, if the opponent is online, current player turn, and board cells data.
	\item \textbf{UserMessageStateService} -- it is a utility state service which is used to manage which message (if required) is displayed to a user. It ensures that all fired messages will be shown.
\end{itemize}

\subsection{ConnectionService}
The \textbf{ConnectionService} is used to take care of the server connection and messages sending and receiving. It provides a method to establish a connection to the server with provided parameters, and a method to exchange a message with the server (send the given message and read the response message).

\subsection{Message Processors}
The \textbf{Message Processors} are used to process a message on the business logic layer - construct a message using provided parameters and dedicated message type and subtype, send it to the server, retrieve a response message and process received data using \texttt{ConnectionService}. Here is a list of implemented message processors:

\begin{itemize}
	\item \textbf{CommonProcessor} -- is a base implementation for all message processors which performs client-server interaction.  It ensures that every exception thrown during the message sending and receiving is properly handled and propagated to \ac{UI}. It uses coroutines to provide asynchronous execution and to avoid main thread blocking. 
	\item \textbf{CommonClientProcessor} -- is a dedicated implementation which extends \texttt{CommonProcessor} with a client state update method.
	\item \textbf{HandshakeProcessor} -- processing a handshake with the server. Rise a fatal error in case of failure.
	\item \textbf{LoginProcessor} -- processing a client login with provided username.
	\item \textbf{LogoutProcessor} -- processing a client logout.
	\item \textbf{PingProcessor} -- processing a simple ping to the server.
	\item \textbf{GetLobbiesProcessor} -- processing a get of currently available lobbies.
	\item \textbf{CreateLobbyProcessor} -- processing a lobby creation with provided lobby name.
	\item \textbf{ConnectToLobbyProcessor} -- processing a connection to a lobby with a specified name.
	\item \textbf{ExitLobbyProcessor} -- processing an exiting from the current lobby.
	\item \textbf{GetLobbyStateProcessor} -- processing getting a state of the current lobby.
	\item \textbf{StartGameProcessor} -- processing a game start.
	\item \textbf{GetGameStateProcessor} -- processing getting a state of the current game.
	\item \textbf{GameMoveProcessor} -- processing a game move using given coordinates.
\end{itemize}

\subsection{PingService}

The \textbf{PingService} takes care of the regular ping to the server and updates the current client state with the given data from the server. Type of the used message processor depends on the client flow state:

\begin{itemize}
	\item \textbf{no state} -- \texttt{PingProcessor} is used to check server connection state.
	\item \textbf{MENU} -- \texttt{GetLobbiesProcessor} is used to update the list of the available lobbies.
	\item \textbf{LOBBY} -- \texttt{GetLobbyStateProcessor} is used to update the current lobby state.
	\item \textbf{GAME} -- \texttt{GetGameStateProcessor} is used to update the current game state.
\end{itemize}

\section{How to Build and Run}

\subsection{Requirements}

\begin{itemize}
	\item \textbf{\texttt{Windows}} or \textbf{\texttt{Linux}} operation system.
	\item \textbf{\texttt{Java 17+}} -- installed and configured \texttt{Java} of version 17+.
	\item \textbf{\texttt{Gradle 8.7+}} -- installed and configured \texttt{Gradle} of version 8.7+.
\end{itemize}

\subsection{Build and Run}
In the project root folder there are two prepared files: \texttt{gradlew} and \texttt{gradlew-linux}. These files can be used to build and run the project under \texttt{Windows} and \texttt{Linux} operation systems. The example of building the executable file on \texttt{Linux} can be seen in the listing \ref{lst:}

\begin{lstlisting}[language=bash, caption={Example of client build on Linux}, label={lst:client_build}]
# Navigate to the project directory
cd project

./gradlew-linux createDistributable
\end{lstlisting}

After the executable file is build, it can be directly run.

\subsection{Configuration}
Client connection properties such as server IP address, server port and ping intervals can be found in the build directory in the \texttt{config/connection.properties} file.


% _____________________________________________________________________________
%
%
%	     DOCUMENT FRONTMATTER TEXTS
%
% _____________________________________________________________________________
%

\appendix
% _____________________________________________________________________________
%
%
%		APPENDIX CHAPTER
%
% _____________________________________________________________________________
%
\chapter{List of Abbreviations}\label{app:abbreviations}

% Определение аббревиатур
\begin{acronym}
	\acro{UI}[UI]{User Interface}
	\acro{REST}[REST]{Representational State Transfer}
	\acro{KMP}[KMP]{Kotlin multi-platform}
	\acro{CMP}[CMP]{Compose multi-platform}
	\acro{JSON}[JSON]{JavaScript Object Notation}
	\acro{XML}[XML]{Extensible Markup Language}
	\acro{HTTP}[HTTP]{Hypertext Transfer Protocol}
	\acro{MVVM}[MVVM]{Model-View-ViewModel}
\end{acronym}


% _____________________________________________________________________________
%
%
%        BACK MATTER (BIBLIOGRAPHY, LISTS, ...)
%
% _____________________________________________________________________________
%
\backmatter
\listoffigures 
\listoftables
\listoflistings
% _____________________________________________________________________________
%
%		BACK COVER
% _____________________________________________________________________________
%
%\setbackpagepic{img/fav}
%\setqrcodebaseurl{https://mycloud.org/show=pdf&docid=}
%\setbackpageqrcode{54321}
\backpage
\end{document}